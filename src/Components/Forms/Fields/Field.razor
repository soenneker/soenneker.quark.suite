@namespace Soenneker.Quark
@inherits Soenneker.Quark.Element
@implements IField

<CascadingValue Name="ParentField" Value="@this" IsFixed="true">
    <CascadingValue Name="FieldHorizontal" Value="Horizontal" IsFixed="true">
        <div @attributes="BuildAttributes()">
            @ChildContent
        </div>
    </CascadingValue>
</CascadingValue>

@code {
    /// <summary>
    /// Gets or sets whether the field should be displayed horizontally.
    /// </summary>
    [Parameter]
    public bool Horizontal { get; set; }

    /// <summary>
    /// Gets or sets whether the field is invalid for data-[invalid=true] styling.
    /// </summary>
    [Parameter]
    public bool IsInvalid { get; set; }

    protected override void BuildAttributesCore(Dictionary<string, object> attributes)
    {
        base.BuildAttributesCore(attributes);

        attributes.TryAdd("role", "group");
        attributes["data-orientation"] = Horizontal ? "horizontal" : "vertical";
        if (IsInvalid)
            attributes["data-invalid"] = "true";

        // shadcn Field - new-york-v4 ui/field.tsx
        BuildClassAttribute(attributes, (ref cls) =>
        {
            AppendClass(ref cls, "q-field");
            AppendClass(ref cls, "group/field flex w-full gap-3 data-[invalid=true]:text-destructive");
            if (Horizontal)
            {
                AppendClass(ref cls, "flex-row items-center");
                AppendClass(ref cls, "[&>.q-field-label]:flex-auto");
                AppendClass(ref cls, "has-[>.q-field-body]:items-start has-[>.q-field-body]:[&>[role=checkbox],[role=radio]]:mt-px");
            }
            else
            {
                AppendClass(ref cls, "flex-col [&>*]:w-full [&>.sr-only]:w-auto");
            }
        });
    }

    protected override void ComputeRenderKeyCore(ref HashCode hc)
    {
        hc.Add(Horizontal);
        hc.Add(IsInvalid);
    }
}
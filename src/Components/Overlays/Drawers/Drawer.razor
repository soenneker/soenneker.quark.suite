@using Soenneker.Blazor.Extensions.EventCallback

@namespace Soenneker.Quark
@inherits Overlay

<CascadingValue Name="ParentDrawer" Value="@this">
    @ChildContent
</CascadingValue>

@code {
    /// <summary>
    /// Gets or sets the callback invoked when the backdrop is clicked.
    /// </summary>
    [Parameter]
    public EventCallback OnBackdropClick { get; set; }

    /// <summary>
    /// Shows the drawer.
    /// </summary>
    public async Task Show()
    {
        if (Visible)
            return;

        Visible = true;
        await VisibleChanged.InvokeAsync(Visible);
        await OnShow.InvokeIfHasDelegate();
        await RefreshOffThread();
    }

    /// <summary>
    /// Hides the drawer.
    /// </summary>
    public async Task Hide()
    {
        if (!Visible)
            return;

        Visible = false;
        await VisibleChanged.InvokeAsync(Visible);
        await OnHide.InvokeIfHasDelegate();
        await RefreshOffThread();
    }

    protected override void ComputeRenderKeyCore(ref HashCode hc)
    {
        base.ComputeRenderKeyCore(ref hc);
        hc.Add(Visible);
        hc.Add(ShowBackdrop);
        hc.Add(CloseOnBackdropClick);
        hc.Add(CloseOnEscape);
    }
}

@namespace Soenneker.Quark
@inherits Soenneker.Quark.Element

<div @attributes="BuildAttributes()">
    @ChildContent
</div>

@code {
    /// <summary>
    /// Gets or sets offset from the trigger in pixels.
    /// </summary>
    [Parameter]
    public int SideOffset { get; set; }

    protected override void BuildAttributesCore(Dictionary<string, object> attributes)
    {
        base.BuildAttributesCore(attributes);

        attributes["data-slot"] = "tooltip-content";
        attributes["role"] = "tooltip";

        var offset = SideOffset > 0 ? SideOffset : 4;

        BuildClassAttribute(attributes, (ref cls) =>
        {
            AppendClass(ref cls, "q-tooltip-content");
            AppendClass(ref cls, "bg-foreground text-background z-50 w-fit rounded-md px-3 py-1.5 text-xs text-balance");
            AppendClass(ref cls, "absolute left-1/2 -translate-x-1/2 bottom-full");
            AppendClass(ref cls, "opacity-0 invisible group-hover/tooltip:opacity-100 group-hover/tooltip:visible group-focus-within/tooltip:opacity-100 group-focus-within/tooltip:visible transition-opacity pointer-events-none");
            AppendClass(ref cls, "animate-in fade-in-0 zoom-in-95");
        });

        attributes["style"] = $"margin-bottom: {offset}px;";
    }

    protected override void ComputeRenderKeyCore(ref HashCode hc)
    {
        base.ComputeRenderKeyCore(ref hc);
        hc.Add(SideOffset);
    }
}

@using Soenneker.Quark.Components.Surface.Interactive.Buttons.Abstract

@namespace Soenneker.Quark
@inherits Soenneker.Quark.Element
@implements IButtonGroup

<CascadingValue Value="this">
    <div @attributes="BuildAttributes()">
        @ChildContent
    </div>
</CascadingValue>

@code {
    [Parameter]
    public ButtonSize? Size { get; set; }

    [Parameter]
    public bool Vertical { get; set; }

    [Parameter]
    public string? Role { get; set; }

    [Parameter]
    public string? AriaLabel { get; set; }

    // shadcn ButtonGroup - new-york-v4 ui/button-group.tsx
    protected override void BuildAttributesCore(Dictionary<string, object> attributes)
    {
        base.BuildAttributesCore(attributes);

        attributes.TryAdd("data-slot", "button-group");
        attributes["data-orientation"] = Vertical ? "vertical" : "horizontal";
        if (!attributes.ContainsKey("role"))
            attributes["role"] = Role ?? "group";
        if (AriaLabel.HasContent())
            attributes["aria-label"] = AriaLabel;

        BuildClassAttribute(attributes, (ref cls) =>
        {
            AppendClass(ref cls, "q-button-group");
            AppendClass(ref cls, "flex w-fit items-stretch [&>*]:focus-visible:z-10 [&>*]:focus-visible:relative [&>[data-slot=select-trigger]:not([class*='w-'])]:w-fit [&>input]:flex-1 has-[select[aria-hidden=true]:last-child]:[&>[data-slot=select-trigger]:last-of-type]:rounded-r-md has-[>[data-slot=button-group]]:gap-2");
            if (Vertical)
                AppendClass(ref cls, "flex-col [&>*:not(:first-child)]:rounded-t-none [&>*:not(:first-child)]:border-t-0 [&>*:not(:last-child)]:rounded-b-none");
            else
                AppendClass(ref cls, "[&>*:not(:first-child)]:rounded-l-none [&>*:not(:first-child)]:border-l-0 [&>*:not(:last-child)]:rounded-r-none");
        });
    }

    protected override void ComputeRenderKeyCore(ref HashCode hc)
    {
        hc.Add(Size);
        hc.Add(Vertical);
        hc.Add(Role);
        hc.Add(AriaLabel);
    }
}
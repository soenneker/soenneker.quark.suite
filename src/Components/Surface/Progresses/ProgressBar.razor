@namespace Soenneker.Quark
@inherits Soenneker.Quark.Element
@implements IProgressBar

<div @attributes="BuildAttributes()" role="progressbar" aria-valuenow="@Value" aria-valuemin="0" aria-valuemax="100" >
    @if (ShowLabel)
    {
        @($"{Value}%")
    }
    @ChildContent
</div>

@code {

    [Parameter]
    public new RenderFragment? ChildContent { get; set; }

    /// <summary>
    /// Gets or sets the progress value (0-100).
    /// </summary>
    [Parameter]
    public int Value { get; set; }

    /// <summary>
    /// Gets or sets whether the progress bar should be striped.
    /// </summary>
    [Parameter]
    public bool Striped { get; set; }

    /// <summary>
    /// Gets or sets whether the progress bar should be animated.
    /// </summary>
    [Parameter]
    public bool Animated { get; set; }

    /// <summary>
    /// Gets or sets whether to show the label with the percentage.
    /// </summary>
    [Parameter]
    public bool ShowLabel { get; set; } = true;

    protected override Dictionary<string, object> BuildAttributes()
    {
        var attributes = base.BuildAttributes();

        string? bgClass = null;
        if (BackgroundColor is not null && !BackgroundColor.Value.IsEmpty)
        {
            var v = BackgroundColor.Value.ToString().Trim();
            if (BackgroundColor.Value.IsCssClass)
            {
                bgClass = v.StartsWith("bg-", StringComparison.Ordinal) ? v : $"bg-{v}";
            }
        }

        BuildClassAttribute(attributes, (ref PooledStringBuilder cls) =>
        {
            AppendClass(ref cls, "q-progress-bar");
            AppendClass(ref cls, "progress-bar");
            
            if (Striped)
                AppendClass(ref cls, "progress-bar-striped");
            if (Animated)
                AppendClass(ref cls, "progress-bar-animated");
            if (bgClass != null)
                AppendClass(ref cls, bgClass);
        });

        BuildStyleAttribute(attributes, (ref PooledStringBuilder sty) => AppendStyleDecl(ref sty, $"width: {Value}%"));

        return attributes;
    }


}

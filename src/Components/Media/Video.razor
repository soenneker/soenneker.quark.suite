@namespace Soenneker.Quark
@inherits VisualMediaElement
@implements IVideo

<video @attributes="BuildAttributes()">
	@ChildContent
</video>

@code {
    // shadcn - new-york-v4
    /// <summary>
    /// Gets or sets the poster image URL for the video.
    /// </summary>
    [Parameter]
    public string? Poster { get; set; }

    /// <summary>
    /// Gets or sets whether the video should autoplay.
    /// </summary>
    [Parameter]
    public bool Autoplay { get; set; }

    /// <summary>
    /// Gets or sets whether the video should loop.
    /// </summary>
    [Parameter]
    public bool Loop { get; set; }

    /// <summary>
    /// Gets or sets whether the video should be muted.
    /// </summary>
    [Parameter]
    public bool Muted { get; set; }

    /// <summary>
    /// Gets or sets whether to show video controls.
    /// </summary>
    [Parameter]
    public bool Controls { get; set; } = true;

    /// <summary>
    /// Gets or sets the preload attribute value.
    /// </summary>
    [Parameter]
    public string? Preload { get; set; }

    /// <summary>
    /// Gets or sets the crossorigin attribute value.
    /// </summary>
    [Parameter]
    public string? CrossOrigin { get; set; }

    /// <summary>
    /// Gets or sets whether the video should play inline on mobile devices.
    /// </summary>
    [Parameter]
    public bool PlaysInline { get; set; }

    /// <summary>
    /// Gets or sets whether to disable remote playback.
    /// </summary>
    [Parameter]
    public bool DisableRemotePlayback { get; set; }

    /// <summary>
    /// Gets or sets whether to disable picture-in-picture.
    /// </summary>
    [Parameter]
    public bool DisablePictureInPicture { get; set; }

    /// <summary>
    /// Gets or sets the callback invoked When video metadata is loaded.
    /// </summary>
    [Parameter]
    public EventCallback<ProgressEventArgs> OnLoadedMetadata { get; set; }

    /// <summary>
    /// Gets or sets the callback invoked When the video can start playing.
    /// </summary>
    [Parameter]
    public EventCallback<EventArgs> OnCanPlay { get; set; }

    /// <summary>
    /// Gets or sets the callback invoked When the video starts playing.
    /// </summary>
    [Parameter]
    public EventCallback<EventArgs> OnPlay { get; set; }

    /// <summary>
    /// Gets or sets the callback invoked When the video is paused.
    /// </summary>
    [Parameter]
    public EventCallback<EventArgs> OnPause { get; set; }

    /// <summary>
    /// Gets or sets the callback invoked When the video ends.
    /// </summary>
    [Parameter]
    public EventCallback<EventArgs> OnEnded { get; set; }

    /// <summary>
    /// Gets or sets the callback invoked When a video error occurs.
    /// </summary>
    [Parameter]
    public EventCallback<ErrorEventArgs> OnError { get; set; }

    /// <summary>
    /// Gets or sets the callback invoked When the video playback time updates.
    /// </summary>
    [Parameter]
    public EventCallback<EventArgs> OnTimeUpdate { get; set; }

    /// <summary>
    /// Gets or sets the callback invoked When the video volume changes.
    /// </summary>
    [Parameter]
    public EventCallback<EventArgs> OnVolumeChange { get; set; }

    protected override void BuildAttributesCore(Dictionary<string, object> attributes)
    {
        base.BuildAttributesCore(attributes);
        BuildClassAttribute(attributes, (ref cls) => AppendClass(ref cls, "q-video"));

        // Add video-specific attributes
        if (Source.HasContent())
            attributes["src"] = Source;

        if (Poster.HasContent())
            attributes["poster"] = Poster;

        if (Autoplay)
            attributes["autoplay"] = true;

        if (Loop)
            attributes["loop"] = true;

        if (Muted)
            attributes["muted"] = true;

        if (Controls)
            attributes["controls"] = true;

        if (Preload.HasContent())
            attributes["preload"] = Preload;

        if (CrossOrigin.HasContent())
            attributes["crossorigin"] = CrossOrigin;

        if (PlaysInline)
            attributes["playsinline"] = true;

        if (DisableRemotePlayback)
            attributes["disableremoteplayback"] = true;

        if (DisablePictureInPicture)
            attributes["disablepictureinpicture"] = true;

        // Add event handlers
        if (OnLoadedMetadata.HasDelegate)
            attributes["onloadedmetadata"] = EventCallback.Factory.Create(this, OnLoadedMetadata);

        if (OnCanPlay.HasDelegate)
            attributes["oncanplay"] = EventCallback.Factory.Create(this, OnCanPlay);

        if (OnPlay.HasDelegate)
            attributes["onplay"] = EventCallback.Factory.Create(this, OnPlay);

        if (OnPause.HasDelegate)
            attributes["onpause"] = EventCallback.Factory.Create(this, OnPause);

        if (OnEnded.HasDelegate)
            attributes["onended"] = EventCallback.Factory.Create(this, OnEnded);

        if (OnError.HasDelegate)
            attributes["onerror"] = EventCallback.Factory.Create(this, OnError);

        if (OnTimeUpdate.HasDelegate)
            attributes["ontimeupdate"] = EventCallback.Factory.Create(this, OnTimeUpdate);

        if (OnVolumeChange.HasDelegate)
            attributes["onvolumechange"] = EventCallback.Factory.Create(this, OnVolumeChange);
    }

    protected override void ComputeRenderKeyCore(ref HashCode hc)
    {
        hc.Add(Poster);
        hc.Add(Autoplay);
        hc.Add(Loop);
        hc.Add(Muted);
        hc.Add(Controls);
        hc.Add(Preload);
        hc.Add(CrossOrigin);
        hc.Add(PlaysInline);
        hc.Add(DisableRemotePlayback);
        hc.Add(DisablePictureInPicture);
        hc.Add(OnLoadedMetadata);
        hc.Add(OnCanPlay);
        hc.Add(OnPlay);
        hc.Add(OnPause);
        hc.Add(OnEnded);
        hc.Add(OnError);
        hc.Add(OnTimeUpdate);
        hc.Add(OnVolumeChange);
    }
}
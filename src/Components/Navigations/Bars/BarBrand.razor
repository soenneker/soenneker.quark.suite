@namespace Soenneker.Quark

@inherits Soenneker.Quark.Element
@implements IBarBrand

<div @attributes="BuildAttributes()">
    @ChildContent
</div>

@code {
    /// <summary>
    /// Gets or sets the URL to navigate to when the brand is clicked.
    /// </summary>
    [Parameter]
    public string? To { get; set; }

    [CascadingParameter]
    public BarMode Mode { get; set; } = BarMode.Horizontal;

    [CascadingParameter(Name = "VerticalBarCollapsed")]
    public bool VerticalBarCollapsed { get; set; }

    protected override bool ShouldRender()
    {
        // For vertical bars, always render when vertical bar collapse state might change
        // The base component's render key doesn't track cascading parameters
        if (Mode != BarMode.Horizontal)
        {
            return true;
        }

        return base.ShouldRender();
    }

    protected override void BuildAttributesCore(Dictionary<string, object> attributes)
    {
        base.BuildAttributesCore(attributes);

        BuildClassAttribute(attributes, (ref cls) =>
        {
            AppendClass(ref cls, "q-bar-brand");
            if (Mode == BarMode.Horizontal)
            {
                AppendClass(ref cls, "navbar-brand");
            }
            
            AppendClass(ref cls, "d-flex");
            AppendClass(ref cls, "align-items-center");
            
            if (Mode != BarMode.Horizontal)
            {
                AppendClass(ref cls, "p-3");
            }
        });

        if (Mode != BarMode.Horizontal)
        {
            BuildStyleAttribute(attributes, (ref sty) =>
            {
                AppendStyleDecl(ref sty, "transition: opacity 0.3s ease, max-height 0.3s ease, padding 0.3s ease");
                AppendStyleDecl(ref sty, "overflow: hidden");
                
                if (VerticalBarCollapsed)
                {
                    AppendStyleDecl(ref sty, "opacity: 0");
                    AppendStyleDecl(ref sty, "max-height: 0");
                    AppendStyleDecl(ref sty, "padding-top: 0");
                    AppendStyleDecl(ref sty, "padding-bottom: 0");
                }
                else
                {
                    AppendStyleDecl(ref sty, "opacity: 1");
                    AppendStyleDecl(ref sty, "max-height: 100px");
                }
            });
        }

        if (To.HasContent())
        {
            attributes["href"] = To;
        }
    }

    protected override void ComputeRenderKeyCore(ref HashCode hc)
    {
        hc.Add(To);
        hc.Add(Mode);
        hc.Add(VerticalBarCollapsed);
    }
}
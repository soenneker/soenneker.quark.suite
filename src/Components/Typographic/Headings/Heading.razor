@namespace Soenneker.Quark
@inherits Soenneker.Quark.TypographicElement
@implements IHeading

@{
    int level = GetHeadingLevel(Scale);
    IReadOnlyDictionary<string, object> attrs = BuildAttributes();
}

@if (level == 1)
{
    <h1 @attributes="attrs">@ChildContent</h1>
}
else if (level == 2)
{
    <h2 @attributes="attrs">@ChildContent</h2>
}
else if (level == 3)
{
    <h3 @attributes="attrs">@ChildContent</h3>
}
else if (level == 4)
{
    <h4 @attributes="attrs">@ChildContent</h4>
}
else if (level == 5)
{
    <h5 @attributes="attrs">@ChildContent</h5>
}
else
{
    <h6 @attributes="attrs">@ChildContent</h6>
}

@code {
    // shadcn - new-york-v4

    [Parameter]
    public CssValue<ScaleBuilder>? Scale { get; set; }


    protected override void BuildAttributesCore(Dictionary<string, object> attributes)
    {
        base.BuildAttributesCore(attributes);

        BuildClassAndStyleAttributes(attributes, (ref cls, ref sty) =>
        {
            AppendClass(ref cls, "q-heading");
            int headingLevel = GetHeadingLevel(Scale);
            AppendClass(ref cls, GetHeadingSizeClass(headingLevel));
            AddCss(ref sty, ref cls, Scale);
        });
    }

    

    private static int GetHeadingLevel(CssValue<ScaleBuilder>? scale)
    {
        const int fallback = 3;
        var s = scale?.ToString();

        if (s.IsNullOrWhiteSpace())
            return fallback;

        if (s.Length >= 7 && s.AsSpan().StartsWith("scale-"))
        {
            int d = s[^1] - '0';

            if ((uint)(d - 1) <= 5)
                return d; // 1..6
        }

        return fallback;
    }

    private static string GetHeadingSizeClass(int level)
    {
        return level switch
        {
            1 => "text-4xl font-bold tracking-tight",
            2 => "text-3xl font-bold tracking-tight",
            3 => "text-2xl font-semibold tracking-tight",
            4 => "text-xl font-semibold",
            5 => "text-lg font-medium",
            _ => "text-base font-medium" // 6 or fallback
        };
    }

    protected override void ComputeRenderKeyCore(ref HashCode hc)
    {
        AddIf(ref hc, Scale);
    }
}
@namespace Soenneker.Quark
@inherits Element

@if (IsLoading)
{
    <div @attributes="BuildAttributes()">
        <div Class="q-table-loader-overlay">
            <div Class="q-table-loader-content">
                <div Class="q-table-loader-default">
                    <div Class="q-table-spinner"></div>
                    <span>Loading...</span>
                </div>
                @ChildContent
            </div>
        </div>
    </div>
}

@code {
	[CascadingParameter(Name = nameof(IsLoading))]
	public bool IsLoading { get; set; }

	private bool _lastIsLoading;

	protected override bool ShouldRender()
	{
		if (QuarkOptions.AlwaysRender)
			return true;

		if (IsLoading != _lastIsLoading)
		{
			_lastIsLoading = IsLoading;
			return true;
		}

		return base.ShouldRender();
	}

	// shadcn Skeleton/Spinner overlay - new-york-v4 ui/skeleton.tsx + spinner
	protected override void BuildAttributesCore(Dictionary<string, object> attributes)
	{
		BuildClassAttribute(attributes, (ref cls) =>
		{
			AppendClass(ref cls, "q-table-loader");
			if (IsLoading)
			{
				AppendClass(ref cls, "q-table-loader-active");
			}
		});
	}

	protected override void ComputeRenderKeyCore(ref HashCode hc)
	{
		hc.Add(IsLoading);
	}
}
@namespace Soenneker.Quark
@inherits Element

@if (IsLoading)
{
    <div @attributes="BuildAttributes()">
        <div Class="q-table-loader-overlay absolute inset-0 flex items-center justify-center bg-background/70 backdrop-blur-[2px]">
            <div Class="q-table-loader-content flex min-h-20 min-w-[120px] items-center justify-center rounded-md border bg-card p-6 shadow-sm">
                <div Class="q-table-loader-default flex items-center gap-2 text-muted-foreground">
                    <div Class="q-table-spinner h-8 w-8 animate-spin rounded-full border-2 border-border border-t-primary"></div>
                    <span class="text-sm">Loading...</span>
                </div>
                @ChildContent
            </div>
        </div>
    </div>
}

@code {
	[CascadingParameter(Name = nameof(IsLoading))]
	public bool IsLoading { get; set; }

	private bool _lastIsLoading;

	protected override bool ShouldRender()
	{
		if (QuarkOptions.AlwaysRender)
			return true;

		if (IsLoading != _lastIsLoading)
		{
			_lastIsLoading = IsLoading;
			return true;
		}

		return base.ShouldRender();
	}

	// shadcn Skeleton/Spinner overlay - new-york-v4 ui/skeleton.tsx + spinner
	protected override void BuildAttributesCore(Dictionary<string, object> attributes)
	{
		BuildClassAttribute(attributes, (ref cls) =>
		{
			AppendClass(ref cls, "q-table-loader");
			if (IsLoading)
				AppendClass(ref cls, "q-table-loader-active");
			AppendClass(ref cls, "absolute inset-0 z-10");
		});
	}

	protected override void ComputeRenderKeyCore(ref HashCode hc)
	{
		hc.Add(IsLoading);
	}
}
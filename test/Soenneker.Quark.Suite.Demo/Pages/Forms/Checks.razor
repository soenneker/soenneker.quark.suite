@page "/forms/checks"
@using System.ComponentModel.DataAnnotations
@using Microsoft.AspNetCore.Components.Forms

<PageTitle>Checkbox Component - Quark Suite</PageTitle>

<div class="space-y-8 max-w-4xl">
    <div class="space-y-4">
        <DemoSection Title="Basic Usage" Description="Simple checkbox with label using two-way binding." Code="@(@"<Check @bind-Checked=""_basicChecked"" Id=""basic-checkbox"">Accept terms and conditions</Check>
<p class=""text-sm text-muted-foreground"">Current state: @(_basicChecked ? ""Checked ✓"" : ""Unchecked"")</p>")">
            <div class="space-y-3">
                <Check @bind-Checked="_basicChecked" Id="basic-checkbox">Accept terms and conditions</Check>
                <p class="text-sm text-muted-foreground">Current state: @(_basicChecked ? "Checked ✓" : "Unchecked")</p>
            </div>
        </DemoSection>
    </div>

    <div class="space-y-4">
        <DemoSection Title="Multiple Options" Description="Group of checkboxes for multiple selections." Code="@(@"<Check @bind-Checked=""_option1"" Id=""option1"">Email notifications</Check>
<Check @bind-Checked=""_option2"" Id=""option2"">SMS notifications</Check>
<Check @bind-Checked=""_option3"" Id=""option3"">Push notifications</Check>")">
            <div class="space-y-3">
                <Check @bind-Checked="_option1" Id="option1">Email notifications</Check>
                <Check @bind-Checked="_option2" Id="option2">SMS notifications</Check>
                <Check @bind-Checked="_option3" Id="option3">Push notifications</Check>
                <p class="text-sm text-muted-foreground">Selected: @string.Join(", ", GetSelectedOptions())</p>
            </div>
        </DemoSection>
    </div>

    <div class="space-y-4">
        <DemoSection Title="Indeterminate" Description="A parent checkbox that reflects child checkbox state." Code="@(@"<Check Checked=""_selectAllChecked"" CheckedChanged=""HandleSelectAllChanged"" Indeterminate=""_selectAllIndeterminate"" Id=""select-all"">Select all</Check>
<div class=""ml-6 space-y-3"">
    <Check Checked=""_itemRead"" CheckedChanged=""(v => { _itemRead = v; UpdateSelectAll(); })"" Id=""item-read"">Read</Check>
    <Check Checked=""_itemWrite"" CheckedChanged=""(v => { _itemWrite = v; UpdateSelectAll(); })"" Id=""item-write"">Write</Check>
    <Check Checked=""_itemExecute"" CheckedChanged=""(v => { _itemExecute = v; UpdateSelectAll(); })"" Id=""item-execute"">Execute</Check>
</div>")">
            <div class="space-y-3">
                <Check Checked="@_selectAllChecked" CheckedChanged="HandleSelectAllChanged" Indeterminate="@_selectAllIndeterminate" Id="select-all">Select all</Check>
                <div class="ml-6 space-y-3">
                    <Check Checked="@_itemRead" CheckedChanged="@(v => { _itemRead = v; UpdateSelectAll(); })" Id="item-read">Read</Check>
                    <Check Checked="@_itemWrite" CheckedChanged="@(v => { _itemWrite = v; UpdateSelectAll(); })" Id="item-write">Write</Check>
                    <Check Checked="@_itemExecute" CheckedChanged="@(v => { _itemExecute = v; UpdateSelectAll(); })" Id="item-execute">Execute</Check>
                </div>
            </div>
        </DemoSection>
    </div>

    <div class="space-y-4">
        <DemoSection Title="Disabled State" Description="Checkboxes that cannot be interacted with." Code="@(@"<Check Disabled=""true"" Checked=""false"" Id=""disabled-unchecked"">Disabled (unchecked)</Check>
<Check Disabled=""true"" Checked=""true"" Id=""disabled-checked"">Disabled (checked)</Check>")">
            <div class="space-y-3">
                <Check Disabled="true" Checked="false" Id="disabled-unchecked">Disabled (unchecked)</Check>
                <Check Disabled="true" Checked="true" Id="disabled-checked">Disabled (checked)</Check>
            </div>
        </DemoSection>
    </div>

    <div class="space-y-4">
        <DemoSection Title="Form Validation" Description="Checkbox integrated with Blazor EditForm validation." Code="@(@"<EditForm Model=""_formModel"" OnValidSubmit=""HandleValidSubmit"" class=""space-y-4"">
    <DataAnnotationsValidator />
    <Check @bind-Checked=""_formModel.AcceptTerms"" Id=""terms"">I accept the terms and conditions</Check>
    <ValidationMessage For=""@(() => _formModel.AcceptTerms)"" class=""text-sm text-destructive"" />
    <Check @bind-Checked=""_formModel.Subscribe"" Id=""subscribe"">Subscribe to newsletter (optional)</Check>
    <Button Type=""ButtonType.Submit"" Variant=""ButtonVariant.Default"">Submit</Button>
</EditForm>")">
            <EditForm Model="_formModel" OnValidSubmit="HandleValidSubmit" class="space-y-4">
                <DataAnnotationsValidator />
                <div class="space-y-3">
                    <Check @bind-Checked="_formModel.AcceptTerms" Id="terms">I accept the terms and conditions</Check>
                    <ValidationMessage For="@(() => _formModel.AcceptTerms)" class="text-sm text-destructive" />
                </div>
                <div class="space-y-3">
                    <Check @bind-Checked="_formModel.Subscribe" Id="subscribe">Subscribe to newsletter (optional)</Check>
                </div>
                <div class="flex gap-4">
                    <Button Type="@ButtonType.Submit" Variant="ButtonVariant.Default">Submit</Button>
                    <Button Type="@ButtonType.Button" Variant="ButtonVariant.Outline" OnClick="@(_ => ResetForm())">Reset</Button>
                </div>
                @if (!string.IsNullOrEmpty(_formMessage))
                {
                    <div class="p-4 bg-card rounded-lg border">
                        <p class="text-sm">@_formMessage</p>
                    </div>
                }
            </EditForm>
        </DemoSection>
    </div>

    <div class="space-y-4">
        <DemoSection Title="Interactive" Description="Checkbox with custom state messaging." Code="@(@"<Check @bind-Checked=""_interactiveCheckedState"" Id=""interactive"">Toggle feature flag</Check>
@if (_interactiveCheckedState) { ... enabled message ... } else { ... disabled message ... }")">
            <div class="space-y-3">
                <Check @bind-Checked="_interactiveCheckedState" Id="interactive">Toggle feature flag</Check>
                @if (_interactiveCheckedState)
                {
                    <div class="p-4 bg-primary/10 rounded-lg border border-primary">
                        <p class="text-sm">Feature is enabled! Last toggled at @_lastToggleTime</p>
                    </div>
                }
                else
                {
                    <div class="p-4 bg-muted rounded-lg">
                        <p class="text-sm text-muted-foreground">Feature is disabled.</p>
                    </div>
                }
            </div>
        </DemoSection>
    </div>

    <div class="space-y-4">
        <DemoSection Title="Accessibility" Description="Keyboard navigation and screen reader support." Code="@(@"<p>Tab focuses checkboxes in sequence.</p>
<p>Space and Enter toggle focused checkboxes.</p>
<p>ARIA state is exposed via role, aria-checked, and aria-disabled.</p>")">
            <div class="space-y-2 text-sm">
                <p>Tab focuses checkboxes in sequence.</p>
                <p>Space and Enter toggle focused checkboxes.</p>
                <p>ARIA state is exposed via role, aria-checked, and aria-disabled.</p>
            </div>
        </DemoSection>
    </div>
</div>

@code {
    private bool _basicChecked;

    private bool _option1 = true;
    private bool _option2;
    private bool _option3 = true;

    private bool _selectAllChecked;
    private bool _selectAllIndeterminate;
    private bool _itemRead = true;
    private bool _itemWrite;
    private bool _itemExecute;

    private bool _interactiveChecked;
    private bool _interactiveCheckedState
    {
        get => _interactiveChecked;
        set
        {
            _interactiveChecked = value;
            if (value)
                _lastToggleTime = DateTime.Now.ToString("HH:mm:ss");
        }
    }
    private string _lastToggleTime = "";

    private FormModel _formModel = new();
    private string _formMessage = "";

    protected override void OnInitialized()
    {
        UpdateSelectAll();
    }

    private void HandleSelectAllChanged(bool value)
    {
        _selectAllChecked = value;
        _selectAllIndeterminate = false;
        _itemRead = value;
        _itemWrite = value;
        _itemExecute = value;
    }

    private void UpdateSelectAll()
    {
        var all = _itemRead && _itemWrite && _itemExecute;
        var none = !_itemRead && !_itemWrite && !_itemExecute;
        _selectAllChecked = all;
        _selectAllIndeterminate = !all && !none;
    }

    private void HandleValidSubmit()
    {
        _formMessage = $"Submitted at {DateTime.Now:HH:mm:ss}. Terms: {_formModel.AcceptTerms}, Subscribe: {_formModel.Subscribe}";
    }

    private void ResetForm()
    {
        _formModel = new FormModel();
        _formMessage = "";
    }

    private List<string> GetSelectedOptions()
    {
        var selected = new List<string>();
        if (_option1) selected.Add("Email");
        if (_option2) selected.Add("SMS");
        if (_option3) selected.Add("Push");
        return selected.Count > 0 ? selected : new List<string> { "None" };
    }

    private sealed class FormModel
    {
        [Required(ErrorMessage = "You must accept terms.")]
        [Range(typeof(bool), "true", "true", ErrorMessage = "You must accept terms.")]
        public bool AcceptTerms { get; set; }

        public bool Subscribe { get; set; }
    }
}

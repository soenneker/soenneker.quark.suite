@page "/forms/datepickers"

<PageTitle>Date Pickers - Quark Suite</PageTitle>

<Div Class="space-y-8 max-w-4xl">
    <Div Class="space-y-6">
        <section class="space-y-4">
            <DemoSection Title="Binding test" Description="Select dates below or click 'Load Test Data' to verify binding works." Code="@(@"<DatePicker Id=""testDatePicker1"" @bind-Value=""_testDatePicker1""/>
<DatePicker Id=""testDatePicker2"" @bind-Value=""_testDatePicker2""/>")">
                <Div Class="p-4 rounded-lg border border-border bg-muted/30 space-y-4">
                    <H3 Class="text-lg font-semibold" Margin="Margin.Is0.FromBottom">Two-Way Binding</H3>

                    <Field>
                        <FieldLabel For="testDatePicker1">Test DatePicker 1:</FieldLabel>
                        <FieldBody>
                            <DatePicker Id="testDatePicker1" @bind-Value="_testDatePicker1"/>
                            <Div Margin="Margin.Is2.FromTop" Padding="Padding.Is2" Class="rounded border border-border bg-background">
                                <Strong>Bound Value:</Strong> <Code>@(_testDatePicker1?.ToString("yyyy-MM-dd") ?? "(empty)")</Code>
                            </Div>
                        </FieldBody>
                    </Field>

                    <Field>
                        <FieldLabel For="testDatePicker2">Test DatePicker 2 (Pre-set to today):</FieldLabel>
                        <FieldBody>
                            <DatePicker Id="testDatePicker2" @bind-Value="_testDatePicker2"/>
                            <Div Margin="Margin.Is2.FromTop" Padding="Padding.Is2" Class="rounded border border-border bg-background">
                                <Strong>Bound Value:</Strong> <Code>@(_testDatePicker2?.ToString("yyyy-MM-dd") ?? "(empty)")</Code>
                            </Div>
                        </FieldBody>
                    </Field>

                    <Div Class="flex flex-wrap gap-2 mt-4">
                        <Button Class="bg-primary text-primary-foreground" OnClick="LoadDatePickerTestData">Load Test Data</Button>
                        <Button Class="bg-secondary text-secondary-foreground" OnClick="ClearDatePickerTestData">Clear Test Data</Button>
                        <Button Class="bg-muted text-muted-foreground" OnClick="UpdateDatePickerTestData">Update to Random Dates</Button>
                    </Div>

                    <Div Class="mt-4 p-3 rounded-lg border border-border bg-muted/30">
                        <H4 Class="text-sm font-semibold">Test Results:</H4>
                        <UnorderedList Margin="Margin.Is0.FromBottom">
                            <UnorderedListItem>
                                <Strong>DatePicker 1:</Strong> @(_testDatePicker1?.ToString("yyyy-MM-dd") ?? "(not set)")
                            </UnorderedListItem>
                            <UnorderedListItem>
                                <Strong>DatePicker 2:</Strong> @(_testDatePicker2?.ToString("yyyy-MM-dd") ?? "(not set)")
                            </UnorderedListItem>
                        </UnorderedList>
                    </Div>
                </Div>
            </DemoSection>
        </section>

        <DemoSection Title="DateOnly" Description="Simple date selection with DatePicker." Code="@(@"<Label Form=""true"">Pick a date</Label>
<DatePicker @bind-Value=""_dateOnly""/>")">
            <Label Form="true">Pick a date</Label>
            <DatePicker @bind-Value="_dateOnly"/>
            <Div Class="value-chip" Margin="Margin.Is2.FromTop">
                <Span Class="dot"></Span><Span>Value: @_dateOnly?.ToString("yyyy-MM-dd")</Span>
            </Div>
        </DemoSection>
        <DemoSection Title="DateTime" Description="Date and time with DateTimePicker." Code="@(@"<Label Form=""true"">Pick a date and time</Label>
<DateTimePicker @bind-Value=""_dateTime""/>")">
            <Label Form="true">Pick a date and time</Label>
            <DateTimePicker @bind-Value="_dateTime"/>
            <Div Class="value-chip" Margin="Margin.Is2.FromTop">
                <Span Class="dot"></Span><Span>Value: @_dateTime?.ToString("yyyy-MM-dd HH:mm:ss")</Span>
            </Div>
        </DemoSection>
    </Div>
</Div>

@code{

    // Binding Test Fields
    private DateOnly? _testDatePicker1;
    private DateOnly? _testDatePicker2 = DateOnly.FromDateTime(DateTime.Today);

    private DateOnly? _dateOnly = DateOnly.FromDateTime(DateTime.Today);
    private DateTime? _dateTime = DateTime.Now;

    private DateOnly? _validatedDate;
    private DateTime? _validatedDateTime;

    private void LoadDatePickerTestData()
    {
        _testDatePicker1 = DateOnly.FromDateTime(new DateTime(2025, 12, 25));
        _testDatePicker2 = DateOnly.FromDateTime(new DateTime(2026, 1, 1));
    }

    private void ClearDatePickerTestData()
    {
        _testDatePicker1 = null;
        _testDatePicker2 = null;
    }

    private void UpdateDatePickerTestData()
    {
        var random = new Random();
        _testDatePicker1 = DateOnly.FromDateTime(DateTime.Today.AddDays(random.Next(-365, 365)));
        _testDatePicker2 = DateOnly.FromDateTime(DateTime.Today.AddDays(random.Next(-365, 365)));
    }

    private void ValidateDate(ValidatorEventArgs e)
    {
        if (_validatedDate is null)
        {
            e.Status = ValidationStatus.Error;
            e.ErrorText = "Date is required.";
        }
        else
        {
            e.Status = ValidationStatus.Success;
        }
    }

    private void ValidateDateTime(ValidatorEventArgs e)
    {
        if (_validatedDateTime is null)
        {
            e.Status = ValidationStatus.Error;
            e.ErrorText = "Date/time is required.";
        }
        else
        {
            e.Status = ValidationStatus.Success;
        }
    }

}

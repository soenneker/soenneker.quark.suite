@page "/forms/memoedits"
@using Microsoft.Extensions.Logging
@using Soenneker.Extensions.String

@inject ILogger<Index> Logger

<PageTitle>MemoEdits - Quark Suite</PageTitle>

<Div Class="space-y-8 max-w-4xl">
    <Div Class="space-y-6">
        <Div Class="space-y-4">
            <DemoSection Title="Binding test" Description="Type in the fields below or click 'Load Test Data' to verify binding works." Code="@(@"<MemoEdit Id=""testMemo1"" Placeholder=""Type something..."" @bind-Value=""_testMemo1""/>
<MemoEdit Id=""testMemo2"" Rows=""5"" @bind-Value=""_testMemo2""/>")">
                <Div Class="p-4 rounded-lg border border-border bg-muted/30 space-y-4">
                    <Paragraph Class="text-lg font-semibold" Margin="Margin.Is0.FromBottom">Two-Way Binding</Paragraph>

                    <Field>
                        <FieldLabel For="testMemo1">Test Memo 1:</FieldLabel>
                        <FieldBody>
                            <MemoEdit Id="testMemo1"
                                      Placeholder="Type something here..."
                                      @bind-Value="_testMemo1"/>
                            <Div Margin="Margin.Is2.FromTop" Padding="Padding.Is2" Class="rounded border border-border bg-background">
                                <Strong>Bound Value:</Strong> <Code>@(_testMemo1 ?? "(empty)")</Code>
                            </Div>
                        </FieldBody>
                    </Field>

                    <Field>
                        <FieldLabel For="testMemo2">Test Memo 2 (Pre-populated):</FieldLabel>
                        <FieldBody>
                            <MemoEdit Id="testMemo2"
                                      Placeholder="Type something here..."
                                      @bind-Value="_testMemo2"
                                      Rows="5"/>
                            <Div Margin="Margin.Is2.FromTop" Padding="Padding.Is2" Class="rounded border border-border bg-background">
                                <Strong>Bound Value:</Strong> <Code>@(_testMemo2 ?? "(empty)")</Code>
                            </Div>
                        </FieldBody>
                    </Field>

                    <Div Class="flex flex-wrap gap-2 mt-4">
                        <Button Class="bg-primary text-primary-foreground" OnClick="LoadMemoTestData">Load Test Data</Button>
                        <Button Class="bg-secondary text-secondary-foreground" OnClick="ClearMemoTestData">Clear Test Data</Button>
                        <Button Class="bg-muted text-muted-foreground" OnClick="UpdateMemoTestData">Update to Random Values</Button>
                    </Div>

                    <Div Class="mt-4 p-3 rounded-lg border border-border bg-muted/30">
                        <Paragraph Class="text-sm font-semibold" Margin="Margin.Is0.FromBottom">Test Results:</Paragraph>
                        <UnorderedList Margin="Margin.Is0.FromBottom">
                            <UnorderedListItem>
                                <Strong>Memo 1:</Strong> @(_testMemo1 ?? "(not set)")
                            </UnorderedListItem>
                            <UnorderedListItem>
                                <Strong>Memo 2:</Strong> @(_testMemo2 ?? "(not set)")
                            </UnorderedListItem>
                        </UnorderedList>
                    </Div>
                </Div>
            </DemoSection>
        </Div>

        <DemoSection Title="Basic Usage" Description="Default MemoEdit with placeholder and binding." Code="@(@"<MemoEdit @bind-Value=""_basicValue"" Placeholder=""Enter your text here..."" Rows=""5""/>")">
            <Paragraph Class="font-semibold">Default MemoEdit</Paragraph>
            <MemoEdit @bind-Value="_basicValue" Placeholder="Enter your text here..."/>
            <Paragraph Margin="Margin.Is0"><Strong>Value:</Strong> @_basicValue</Paragraph>
        </DemoSection>

        <DemoSection Title="Size Variations" Description="Size.Small and Size.Large." Code="@(@"<MemoEdit @bind-Value=""_smallValue"" Size=""Size.Small"" Placeholder=""Small...""/>
<MemoEdit @bind-Value=""_largeValue"" Size=""Size.Large"" Placeholder=""Large...""/>")">
            <Paragraph Class="font-semibold">Small Size</Paragraph>
            <MemoEdit @bind-Value="_smallValue" Size="Size.Small" Placeholder="Small memo edit..."/>
            <Paragraph Class="font-semibold mt-4">Large Size</Paragraph>
            <MemoEdit @bind-Value="_largeValue" Size="Size.Large" Placeholder="Large memo edit..."/>
        </DemoSection>

        <DemoSection Title="Color Variations" Description="Color.Primary, Success, Warning, Danger." Code="@(@"<MemoEdit @bind-Value=""_primaryValue"" Color=""Color.Primary"" Placeholder=""Primary...""/>
<MemoEdit @bind-Value=""_successValue"" Color=""Color.Success"" Placeholder=""Success...""/>
<MemoEdit @bind-Value=""_dangerValue"" Color=""Color.Danger"" Placeholder=""Danger...""/>")">
            <Paragraph Class="font-semibold">Primary Color</Paragraph>
            <MemoEdit @bind-Value="_primaryValue" Color="Color.Primary" Placeholder="Primary color memo..."/>
            <Paragraph Class="font-semibold mt-4">Success Color</Paragraph>
            <MemoEdit @bind-Value="_successValue" Color="Color.Success" Placeholder="Success color memo..."/>
            <Paragraph Class="font-semibold mt-4">Warning Color</Paragraph>
            <MemoEdit @bind-Value="_warningValue" Color="Color.Warning" Placeholder="Warning color memo..."/>
            <Paragraph Class="font-semibold mt-4">Danger Color</Paragraph>
            <MemoEdit @bind-Value="_dangerValue" Color="Color.Danger" Placeholder="Danger color memo..."/>
        </DemoSection>

        <DemoSection Title="Row Configuration" Description="Rows attribute for height." Code="@(@"<MemoEdit @bind-Value=""_rows2Value"" Rows=""2"" Placeholder=""2 rows...""/>
<MemoEdit @bind-Value=""_rows5Value"" Rows=""5"" Placeholder=""5 rows...""/>
<MemoEdit @bind-Value=""_rows8Value"" Rows=""8"" Placeholder=""8 rows...""/>")">
            <Paragraph Class="font-semibold">2 Rows</Paragraph>
            <MemoEdit @bind-Value="_rows2Value" Rows="2" Placeholder="2 rows memo..."/>
            <Paragraph Class="font-semibold mt-4">5 Rows</Paragraph>
            <MemoEdit @bind-Value="_rows5Value" Rows="5" Placeholder="5 rows memo..."/>
            <Paragraph Class="font-semibold mt-4">8 Rows</Paragraph>
            <MemoEdit @bind-Value="_rows8Value" Rows="8" Placeholder="8 rows memo..."/>
        </DemoSection>

        <DemoSection Title="Auto Resize" Description="AutoResize=true." Code="@(@"<MemoEdit @bind-Value=""_autoResizeValue"" AutoResize=""true"" Placeholder=""Resizes as you type...""/>")">
            <MemoEdit @bind-Value="_autoResizeValue" AutoResize="true" Placeholder="This memo edit will resize as you type..."/>
        </DemoSection>

        <DemoSection Title="Validation Features" Description="Required, MaxLength, MinLength." Code="@(@"<MemoEdit @bind-Value=""_requiredValue"" Required=""true"" Placeholder=""Required...""/>
<MemoEdit @bind-Value=""_maxLengthValue"" MaxLength=""100"" Placeholder=""Max 100 chars...""/>
<MemoEdit @bind-Value=""_minLengthValue"" MinLength=""10"" Placeholder=""Min 10 chars...""/>")">
            <Paragraph Class="font-semibold">Required Field</Paragraph>
            <MemoEdit @bind-Value="_requiredValue" Required="true" Placeholder="This field is required..."/>
            <Paragraph Class="font-semibold mt-4">Max Length (100 characters)</Paragraph>
            <MemoEdit @bind-Value="_maxLengthValue" MaxLength="100" Placeholder="Maximum 100 characters allowed..."/>
            <Paragraph Margin="Margin.Is0"><Small>Characters: @(_maxLengthValue?.Length ?? 0)/100</Small></Paragraph>
            <Paragraph Class="font-semibold mt-4">Min Length (10 characters)</Paragraph>
            <MemoEdit @bind-Value="_minLengthValue" MinLength="10" Placeholder="Minimum 10 characters required..."/>
        </DemoSection>

        <DemoSection Title="State Variations" Description="Disabled and ReadOnly." Code="@(@"<MemoEdit @bind-Value=""_disabledValue"" Disabled=""true"" Placeholder=""Disabled...""/>
<MemoEdit @bind-Value=""_readOnlyValue"" ReadOnly=""true"" Placeholder=""Read only...""/>")">
            <Paragraph Class="font-semibold">Disabled</Paragraph>
            <MemoEdit @bind-Value="_disabledValue" Disabled="true" Placeholder="This memo edit is disabled..."/>
            <Paragraph Class="font-semibold mt-4">Read Only</Paragraph>
            <MemoEdit @bind-Value="_readOnlyValue" ReadOnly="true" Placeholder="This memo edit is read only..."/>
        </DemoSection>

        <DemoSection Title="Event Handling" Description="OnChange and OnInput." Code="@(@"<MemoEdit @bind-Value=""_changeValue"" OnChange=""OnChangeHandler"" Placeholder=""Type to see change...""/>
<MemoEdit @bind-Value=""_inputValue"" OnInput=""OnInputHandler"" Placeholder=""Type to see input...""/>")">
            <Paragraph Class="font-semibold">With Change Event</Paragraph>
            <MemoEdit @bind-Value="_changeValue" OnChange="OnChangeHandler" Placeholder="Type to see change events..."/>
            <Paragraph Margin="Margin.Is0"><Strong>Last Change:</Strong> @_lastChangeTime</Paragraph>
            <Paragraph Class="font-semibold mt-4">With Input Event</Paragraph>
            <MemoEdit @bind-Value="_inputValue" OnInput="OnInputHandler" Placeholder="Type to see input events..."/>
            <Paragraph Margin="Margin.Is0"><Strong>Last Input:</Strong> @_lastInputTime</Paragraph>
        </DemoSection>

        <DemoSection Title="Form Integration Example" Description="Field, FieldLabel, MemoEdit with validation." Code="@(@"<Field>
    <FieldLabel For=""contactMessage"" RequiredIndicator=""true"">Message:</FieldLabel>
    <FieldBody>
        <MemoEdit Id=""contactMessage"" @bind-Value=""_contactMessage"" Rows=""4"" Required=""true"" MaxLength=""500"" Placeholder=""Enter message...""/>
    </FieldBody>
</Field>")">
            <Paragraph Class="font-semibold">Contact Form</Paragraph>
            <Field>
                <FieldLabel For="contactMessage" RequiredIndicator="true">Message:</FieldLabel>
                <FieldBody>
                    <MemoEdit Id="contactMessage" @bind-Value="_contactMessage" Rows="4" Required="true" MaxLength="500" Color="Color.Primary" Placeholder="Enter your message here..."/>
                </FieldBody>
            </Field>
            <Field>
                <FieldLabel For="additionalNotes">Additional Notes:</FieldLabel>
                <FieldBody>
                    <MemoEdit Id="additionalNotes" @bind-Value="_additionalNotes" Rows="3" AutoResize="true" Color="@Color.Secondary" Placeholder="Any additional notes..."/>
                </FieldBody>
            </Field>
            <Button Class="btn btn-primary" OnClick="SubmitForm">Submit</Button>
            <Paragraph Margin="Margin.Is0"><Strong>Form Status:</Strong> <span class="@GetStatusClass()">@_formStatus</span></Paragraph>
        </DemoSection>

        <DemoSection Title="Character Counter" Description="MaxLength with counter display." Code="@(@"<MemoEdit @bind-Value=""_counterValue"" MaxLength=""200"" OnInput=""OnCounterInput"" Placeholder=""Type to see counter...""/>
<div>@(_counterValue?.Length ?? 0)/200</div>")">
            <MemoEdit @bind-Value="_counterValue" MaxLength="200" OnInput="OnCounterInput" Placeholder="Type to see character counter..."/>
            <Div Class="@($"char-counter {GetCounterClass()}")">@(_counterValue?.Length ?? 0)/200</Div>
        </DemoSection>

        <DemoSection Title="Pre-filled Content" Description="Initial value and Load Sample Content." Code="@(@"<MemoEdit @bind-Value=""_prefilledValue"" Rows=""6"" Color=""Color.Info"" Placeholder=""Pre-filled...""/>
<Button OnClick=""LoadSampleContent"">Load Sample Content</Button>")">
            <MemoEdit @bind-Value="_prefilledValue" Rows="6" Color="Color.Info" Placeholder="This has pre-filled content..."/>
            <Button Class="btn btn-primary" OnClick="LoadSampleContent" Style="margin-top: 10px;">Load Sample Content</Button>
        </DemoSection>
    </Div>
</Div>

@code {

    // Binding Test Fields
    private string? _testMemo1;
    private string? _testMemo2 = "Initial text for Memo 2\nThis has multiple lines\nTo test binding better";

    private string? _basicValue;
    private string? _smallValue;
    private string? _largeValue;
    private string? _primaryValue;
    private string? _successValue;
    private string? _warningValue;
    private string? _dangerValue;
    private string? _rows2Value;
    private string? _rows5Value;
    private string? _rows8Value;
    private string? _autoResizeValue;
    private string? _requiredValue;
    private string? _maxLengthValue;
    private string? _minLengthValue;
    private string? _patternValue;
    private string? _disabledValue = "This is disabled content";
    private string? _readOnlyValue = "This is read-only content";
    private string? _changeValue;
    private string? _inputValue;
    private string? _contactMessage;
    private string? _additionalNotes;
    private string? _counterValue;
    private string? _prefilledValue = "This is some pre-filled content that demonstrates how the MemoEdit component can display existing text.";
    private string? _formStatus = "Ready to submit";

    private DateTime _lastChangeTime;
    private DateTime _lastInputTime;

    protected override void OnInitialized()
    {
        Logger.LogInformation("MemoEdits demo page initialized");
    }

    private void LoadMemoTestData()
    {
        _testMemo1 = "Test Data 1 - Loaded\nThis is a multi-line\ntest value";
        _testMemo2 = "Test Data 2 - Loaded\nWith even more lines\nTo verify binding\nWorks correctly";
        Logger.LogInformation("Memo test data loaded");
    }

    private void ClearMemoTestData()
    {
        _testMemo1 = null;
        _testMemo2 = null;
        Logger.LogInformation("Memo test data cleared");
    }

    private void UpdateMemoTestData()
    {
        _testMemo1 = $"Random-{Guid.NewGuid().ToString()[..8]}\nUpdated at {DateTime.Now:HH:mm:ss}";
        _testMemo2 = $"Random-{Guid.NewGuid().ToString()[..8]}\nMulti-line content\nUpdated at {DateTime.Now:HH:mm:ss}";
        Logger.LogInformation("Memo test data updated with random values");
    }

    private void OnChangeHandler(ChangeEventArgs e)
    {
        _lastChangeTime = DateTime.Now;
        Logger.LogInformation("MemoEdit change event fired at {Time}", _lastChangeTime);
    }

    private void OnInputHandler(ChangeEventArgs e)
    {
        _lastInputTime = DateTime.Now;
        Logger.LogInformation("MemoEdit input event fired at {Time}", _lastInputTime);
    }

    private void OnCounterInput(ChangeEventArgs e)
    {
        // This could be used for real-time validation or UI updates
        StateHasChanged();
    }

    private void SubmitForm()
    {
        if (_contactMessage.IsNullOrWhiteSpace())
        {
            _formStatus = "Message is required!";
            return;
        }

        if (_contactMessage.Length < 10)
        {
            _formStatus = "Message must be at least 10 characters long!";
            return;
        }

        _formStatus = $"Form submitted successfully at {DateTime.Now:HH:mm:ss}! Message: {_contactMessage.Substring(0, Math.Min(50, _contactMessage.Length))}...";

        // Reset form
        _contactMessage = string.Empty;
        _additionalNotes = string.Empty;
    }

    private void LoadSampleContent()
    {
        _prefilledValue = @"This is a sample of longer content that demonstrates how the MemoEdit component handles multi-line text.

It includes:
- Multiple paragraphs
- Line breaks
- Various text formatting

The component automatically handles:
• Resizing
• Scrolling When needed
• Proper text wrapping

You can edit this content to see how the component behaves with different amounts of text.";
    }

    private string GetStatusClass()
    {
        return _formStatus switch
        {
            "Ready to submit" => "status-ready",
            var status when status.Contains("error", StringComparison.OrdinalIgnoreCase) => "status-error",
            var status when status.Contains("success", StringComparison.OrdinalIgnoreCase) => "status-success",
            _ => "status-ready"
        };
    }

    private string GetCounterClass()
    {
        int length = _counterValue?.Length ?? 0;
        return length switch
        {
            var l when l > 180 => "danger",
            var l when l > 160 => "warning",
            _ => ""
        };
    }

}

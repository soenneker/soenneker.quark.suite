@page "/media/videos"
@using Microsoft.Extensions.Logging

@inject ILogger<Index> Logger

<PageTitle>Video & Audio - Quark Suite</PageTitle>

<Div Class="space-y-8 max-w-4xl">
    <Div Class="space-y-6">
        <section class="space-y-4">
            <DemoSection Title="Basic video" Description="HTML5 video with poster and standard controls." Code="@(@"<Video Source=""https://.../video.mp4""
    Poster=""https://.../poster.jpg""
    Style=""width: 100%; max-height: 400px;""
    Border=""Border.Is1""
    BorderRadius=""BorderRadius.Default""/>")">
                <Video 
                    Source="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"
                    Poster="https://peach.blender.org/wp-content/uploads/title_anouncement.jpg?x11217"
                    Style="width: 100%; max-height: 400px;"
                    Border="Border.Is1"
                    BorderRadius="BorderRadius.Default"
                />
            </DemoSection>
        </section>

        <section class="space-y-4">
            <DemoSection Title="Video with options" Description="Autoplay, loop, muted, plays inline." Code="@(@"<Video Source=""..."" Autoplay=""true"" Loop=""true"" Muted=""true"" PlaysInline=""true""/>")">
                            <Paragraph Margin="Margin.Is0">Video player with autoplay, loop, and muted options enabled.</Paragraph>
                            <Video 
                                Source="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4"
                                Autoplay="true"
                                Loop="true"
                                Muted="true"
                                PlaysInline="true"
                                Style="width: 100%; max-height: 300px;"
                                Border="Border.Is1"
                                BorderRadius="BorderRadius.Default"
                            />
                            <Div Margin="Margin.Is3.FromTop">
                                <Badge BackgroundColor="@BackgroundColor.Info">Autoplay</Badge>
                                <Badge BackgroundColor="@BackgroundColor.Success" Margin="Margin.Is2.FromStart">Loop</Badge>
                                <Badge BackgroundColor="@BackgroundColor.Warning" Margin="Margin.Is2.FromStart">Muted</Badge>
                            </Div>
            </DemoSection>
        </section>

        <section class="space-y-4">
            <DemoSection Title="Event handling" Description="Play, pause, ended callbacks." Code="@(@"<Video Source=""..."" OnPlay=""OnPlay"" OnPause=""OnPause"" OnEnded=""OnEnded""/>")">
                            <Paragraph Margin="Margin.Is0">Video with event callbacks for play, pause, and ended states.</Paragraph>
                            
                            @if (!string.IsNullOrEmpty(_videoStatus))
                            {
                                <Alert BackgroundColor="@GetStatusColor()">
                                    <Icon Name="@GetStatusIcon()" Margin="Margin.Is2.FromEnd"/> @_videoStatus
                                </Alert>
                            }
                            
                            <Video 
                                Source="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerEscapes.mp4"
                                OnPlay="HandleVideoPlay"
                                OnPause="HandleVideoPause"
                                OnEnded="HandleVideoEnded"
                                Style="width: 100%; max-height: 350px;"
                                Border="Border.Is1"
                                BorderRadius="BorderRadius.Default"
                            />
            </DemoSection>
        </section>

        <section class="space-y-4">
            <DemoSection Title="Multiple sources" Description="Source elements for format compatibility.">
                <Video 
                                Poster="https://peach.blender.org/wp-content/uploads/title_anouncement.jpg?x11217"
                                Style="width: 100%; max-height: 400px;"
                                Border="Border.Is1"
                                BorderRadius="BorderRadius.Default"
                            >
                                <source src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4" type="video/mp4" />
                                <Text>Your browser does not support the video tag.</Text>
                            </Video>
            </DemoSection>
        </section>

        <section class="space-y-4">
            <DemoSection Title="Audio player" Description="HTML5 audio with controls.">
                <Audio 
                    Source="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"
                    Width="Width.Is100"
                />
            </DemoSection>
        </section>

        <section class="space-y-4">
            <DemoSection Title="Audio with events" Description="Play, pause, ended callbacks.">
                            <Paragraph Margin="Margin.Is0">Audio player with play/pause event tracking.</Paragraph>
                            
                            @if (!string.IsNullOrEmpty(_audioStatus))
                            {
                                <Alert BackgroundColor="@BackgroundColor.Info">
                                    <Icon Name="music" Margin="Margin.Is2.FromEnd"/> @_audioStatus
                                </Alert>
                            }
                            
                            <Audio 
                                Source="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3"
                                OnPlay="HandleAudioPlay"
                                OnPause="HandleAudioPause"
                                OnEnded="HandleAudioEnded"
                                Width="Width.Is100"></Audio>
            </DemoSection>
        </section>

        <section class="space-y-4">
            <DemoSection Title="Audio with loop" Description="Loop continuously.">
                <Audio 
                    Source="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3"
                    Loop="true"
                    Width="Width.Is100"></Audio>
                <Div Class="mt-2">
                    <Badge BackgroundColor="@BackgroundColor.Success">Looping Enabled</Badge>
                </Div>
            </DemoSection>
        </section>
    </Div>
</Div>

@code {
    private string? _videoStatus;
    private string? _audioStatus;

    private void HandleVideoPlay(EventArgs args)
    {
        _videoStatus = "Video is playing";
        Logger.LogInformation("Video started playing");
    }

    private void HandleVideoPause(EventArgs args)
    {
        _videoStatus = "Video paused";
        Logger.LogInformation("Video paused");
    }

    private void HandleVideoEnded(EventArgs args)
    {
        _videoStatus = "Video has ended";
        Logger.LogInformation("Video ended");
    }

    private void HandleAudioPlay(EventArgs args)
    {
        _audioStatus = "Audio is playing";
        Logger.LogInformation("Audio started playing");
    }

    private void HandleAudioPause(EventArgs args)
    {
        _audioStatus = "Audio paused";
        Logger.LogInformation("Audio paused");
    }

    private void HandleAudioEnded(EventArgs args)
    {
        _audioStatus = "Audio has ended";
        Logger.LogInformation("Audio ended");
    }

    private BackgroundColorBuilder GetStatusColor()
    {
        return _videoStatus switch
        {
            "Video is playing" => BackgroundColor.Success,
            "Video paused" => BackgroundColor.Warning,
            "Video has ended" => BackgroundColor.Info,
            _ => BackgroundColor.Secondary
        };
    }

    private string GetStatusIcon()
    {
        return _videoStatus switch
        {
            "Video is playing" => "play",
            "Video paused" => "pause",
            "Video has ended" => "check",
            _ => "info"
        };
    }
}

